// Vari√°veis globais
let carrinho = [];
const numeroWhatsApp = '5546920001218'; // Substitua pelo seu n√∫mero

// Fun√ß√£o para carregar vinhos do Google Sheets
async function carregarVinhos() {
  try {
    const response = await fetch(https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLg6-vjh1ZwN3U-96FGXADNaHGQiMRY2stexsB0iZgyhQ7CdWPiAYBLjWZ_H8UwAluPCWJO_UcTtY8O2n7EmaIN3ubVeaIgIVbQlDPGeJs-V7dhMqxTagrNAGJ5tX0m8yHi8wrWHZ4Dq7IM5btGr6ZUmSNMinlbvt8Z2p16AYIrGuBbUL3UPcw9fZZEQEoNva9gViyWPvGMXakO5SubVbR8eCFYnuQuhP7ZkJhwX8j-GqsFO7fvj_rnd4j0CZxcUrErDpiB6of9HCVRy7FeZtWMG4-ijPQ&lib=MnQYBkRsDbv4uLRxNoSIgA-aoJlzzZ8rm);
    const vinhos = await response.json();
    exibirVinhos(vinhos);
  } catch (error) {
    console.error("Erro ao carregar vinhos:", error);
  }
}

// Fun√ß√£o para exibir vinhos na p√°gina
function exibirVinhos(vinhos) {
  const container = document.getElementById('vinhos-container');
  
  vinhos.forEach(vinho => {
    const card = document.createElement('div');
    card.className = 'vinho-card';
    card.innerHTML = `
      <div class="icone-imagem" onclick="abrirImagem('${vinho['Link Imagem']}')">
        üì∑ Clique para ver imagem
      </div>
      <h3>${vinho['Nome do Vinho']}</h3>
      <p>${vinho['Descri√ß√£o']}</p>
      <p><strong>Pre√ßo:</strong> R$${vinho['Pre√ßo'].toFixed(2)}</p>
      <input type="number" id="qtd-${vinho['Nome do Vinho']}" value="1" min="1">
      <button onclick="adicionarAoCarrinho('${vinho['Nome do Vinho']}', ${vinho['Pre√ßo']}, 
        document.getElementById('qtd-${vinho['Nome do Vinho']}').value)">
        Adicionar ao Carrinho
      </button>
    `;
    container.appendChild(card);
  });
}

// Fun√ß√µes do carrinho (adicionar, remover, calcular total)
function adicionarAoCarrinho(nome, preco, quantidade) {
  quantidade = parseInt(quantidade);
  const itemExistente = carrinho.find(item => item.nome === nome);
  
  if (itemExistente) {
    itemExistente.quantidade += quantidade;
  } else {
    carrinho.push({ nome, preco, quantidade });
  }
  
  atualizarCarrinho();
}

function atualizarCarrinho() {
  const container = document.getElementById('carrinho-container');
  container.innerHTML = '';
  
  carrinho.forEach(item => {
    const div = document.createElement('div');
    div.innerHTML = `
      ${item.nome} - ${item.quantidade}x R$${(item.preco * item.quantidade).toFixed(2)}
      <button onclick="removerItem('${item.nome}')">‚ùå</button>
    `;
    container.appendChild(div);
  });
  
  // Atualiza total
  const total = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
  document.getElementById('total-pedido').textContent = `Total: R$${total.toFixed(2)}`;
}

function removerItem(nome) {
  carrinho = carrinho.filter(item => item.nome !== nome);
  atualizarCarrinho();
}

// Fun√ß√µes do modal de imagem
function abrirImagem(url) {
  const modal = document.getElementById('imagem-modal');
  const img = document.getElementById('imagem-ampliada');
  img.src = url;
  modal.style.display = 'block';
}

document.querySelector('.fechar-modal').onclick = function() {
  document.getElementById('imagem-modal').style.display = 'none';
};

// Finalizar pedido via WhatsApp
function finalizarPedido() {
  if (carrinho.length === 0) return alert("Carrinho vazio!");
  
  let mensagem = "*Pedido de Vinhos:*\n\n";
  carrinho.forEach(item => {
    mensagem += `- ${item.nome} (${item.quantidade}x): R$${(item.preco * item.quantidade).toFixed(2)}\n`;
  });
  
  mensagem += `\n*Total: R$${carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0).toFixed(2)}*`;
  
  window.open(`https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`, '_blank');
}

// Inicia a loja
carregarVinhos();
